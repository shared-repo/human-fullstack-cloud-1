<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ajax</title>
    <style>
        th { text-align: left; background-color:antiquewhite; height: 40px;}
        td { border-bottom: solid 1px black; height: 40px; }
    </style>
</head>
<body>
    <button id="btn-load-users">사용자 목록 조회</button>
    <hr>
    <table id="users" style="display: inline-block; vertical-align: top;">
        <tr>
            <th style="width:50px">ID</th>
            <th style="width:250px">이름</th>
            <th style="width:150px">도시</th>
        </tr>
    </table>
    <div id="user-info" style="border: solid 1px black; margin-left: 10px; padding:10px;width: 300px; height: 475px; display: inline-block; vertical-align: top;"></div>

    <script src="js/jquery-3.7.1.js"></script>
    <script>
        $(() => {
            const tblUsers = $('#users');

            $('#btn-load-users').on('click', (event) => {
                $('.user-row').remove();
                $.ajax({
                    url: "https://jsonplaceholder.typicode.com/users", // 요청 대상 경로
                    method: "GET",      // 데이터 전송 방식 ( 비교: POST )
                    dataType: "JSON",   // 응답 데이터의 형식
                    success: function(users, status, xhr) {
                        users.forEach( user => {
                            const lnk = $('<a></a>').attr('href', 'javascript:')
                                                    .text(user.name)
                                                    .on('click', (event) => {
                                                        fetch(`https://jsonplaceholder.typicode.com/users/${user.id}`)
                                                            .then( resp => resp.json() )
                                                            .then( user => {
                                                                $('#user-info')
                                                                    .empty() // 하위 요소들을 모두 제거 ( remove all )
                                                                    .append( $('<h4></h4>').text(user.id) )
                                                                    .append( $('<h4></h4>').text(user.name) )
                                                                    .append( $('<h4></h4>').text(user.username) )
                                                                    .append( $('<h4></h4>').text(user.email) )
                                                                    .append( $('<h4></h4>').text(user.phone) )
                                                                    .append( $('<h4></h4>').text(user.website) );
                                                            });
                                                    });
                            $('<tr></tr>').addClass('user-row') // <tr class="user-row"></td>
                                          .append( $('<td></td>').text(user.id) )
                                          .append( $('<td></td>').append(lnk) )
                                          .append( $('<td></td>').text(user.address.city) )
                                          .appendTo(tblUsers);

                        } );
                    },
                    error: function(xhr, status, err) {
                    }
                });

            });

        });
        
    </script>

</body>

</html>